var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};$jscomp.arrayFromIterator=function(a){for(var b,c=[];!(b=a.next()).done;)c.push(b.value);return c};
$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};var searchRequest=null;
$(function(){DatosGrles();listarPedidos();listarProdsMasVend();listarCategorias();$(".scroll_cmesa").slimscroll({height:210});$(".scroll_izq").slimscroll({height:400});$(".scroll_der").slimscroll({height:485});$("#busq_prod").keyup(function(){$(".catP").removeClass("active");$(".catS").removeClass("active");var a=$("#moneda").val();$("#list-prods").empty();var b=this,c=$(this).val();if(1<=c.length)null!=searchRequest&&searchRequest.abort(),searchRequest=$.ajax({type:"POST",url:"?c=Inicio&a=BuscarProds",
data:{cod:c},dataType:"JSON",success:function(d){c==$(b).val()&&$.each(d,function(b,c){$("#list-prods").append($('<article class="product animated fadeIn" onclick="add('+c.id_areap+","+c.id_pres+",'"+c.nombre_prod+"','"+c.pres_prod+"',"+c.precio+",'"+c.Impresora.nombre+"');\"/>").append($('<div class="product-img"/>').html('<img src="assets/img/productos/'+c.imagen+'"></img><span class="price-tag">'+a+" "+c.precio+'</span><span class="pres-tag">'+c.pres_prod+"</span>")).append($('<div class="product-nam"/>').html(c.nombre_prod)))})}});
else return $(".catP").addClass("active"),listarProdsMasVend(),!1})});
var DatosGrles=function(){var a=$("#moneda").val();$.ajax({dataType:"JSON",type:"POST",url:"?c=Inicio&a=DatosGrles",data:{cod:$("#cod_p").val(),tp:$("#cod_tipe").val()},success:function(b){var c=0,d=0;$.each(b.Detalle,function(a,b){var d=(b.cantidad*b.precio).toFixed(2);"i"!=b.estado&&0<b.cantidad&&(c=parseFloat(d)+parseFloat(c))});d=parseFloat(c)+parseFloat(d);$("#totalPagar").text(a+""+formatNumber(d));$("#totalPed").val(d.toFixed(2));"0.00"!=d?($(".opc1").css("display","block"),$(".opc2").css("display",
"none")):($(".opc1").css("display","none"),$(".opc2").css("display","block"));if(1==b.id_tipo_p)$(".mes_dg").text(b.nro_mesa),$("#salon_dg").val(b.desc_m),$("#ico-ped").addClass("fa fa-cutlery"),$(".btn-imp").html('<a onclick="impPreCuenta('+b.id_pedido+","+b.id_mesa+",'"+b.est_m+'\')" class="btn btn-botija btn-lg"><i class="fa fa-print"></i></a>');else if(2==b.id_tipo_p||3==b.id_tipo_p)$(".mes_dg").text(b.nro_pedido),$("#ico-ped").addClass("fa fa-slack");$("#cod_tipe").val(b.id_tipo_p);$(".cli_dg").text(b.nomb_c);
$(".fec_dg").text(moment(b.fecha_p).format("DD-MM-Y"));$(".hor_dg").text(moment(b.fecha_p).format("h:mm A"))}})},listarPedidos=function(){$("#list-detped").empty();var a=$("#moneda").val();$.ajax({dataType:"JSON",type:"POST",url:"?c=Inicio&a=listarPedidos",data:{cod:$("#cod_p").val()},success:function(b){$.each(b,function(b,d){var c=(d.cantidad*d.precio).toFixed(2);$("#list-detped").append($('<blockquote class="animated fadeInLeft" style="cursor: pointer;" onclick="subPedido('+$("#cod_p").val()+","+
d.id_pres+');"/>').append('<a class="text-navy"><span class="product-name text-navy">'+d.Producto.nombre_prod+' <span class="label label-warning text-uppercase">'+d.Producto.pres_prod+'</span></span></a><span class="price">'+a+formatNumber(c)+"</span><small><em>"+d.cantidad+"</em> Unidad(es) en "+a+formatNumber(d.precio)+" / Unidad(es)</small>"))})}})},listarCategorias=function(){$("#list-catgrs").empty();$("#list-catgrs").html('<li class="catP active"><a data-toggle="tab" href="#tab-1" onclick="listarProdsMasVend();">&nbsp;<i class="fa fa-star"></i>&nbsp;</a></li>');
$.ajax({dataType:"JSON",type:"POST",url:"?c=Inicio&a=listarCategorias",success:function(a){$.each(a,function(a,c){$("#list-catgrs").append($('<li class="catS animated fadeInRight"/>').append($('<a data-toggle="tab" href="#tab-1" onclick="listarProductos('+c.id_catg+');"/>').html(c.descripcion)))})}})},listarProdsMasVend=function(){$("#busq_prod").val("");var a=$("#moneda").val();$("#list-prods").empty();$.ajax({dataType:"JSON",type:"POST",url:"?c=Inicio&a=listarProdsMasVend",success:function(b){$.each(b,
function(b,d){$("#list-prods").append($('<article class="product animated fadeIn" onclick="add('+d.id_areap+","+d.id_pres+",'"+d.nombre_prod+"','"+d.pres_prod+"',"+d.precio+",'"+d.Impresora.nombre+"');\"/>").append($('<div class="product-img"/>').html('<img src="assets/img/productos/'+d.imagen+'"></img><span class="price-tag">'+a+" "+d.precio+'</span><span class="pres-tag">'+d.pres_prod+"</span>")).append($('<div class="product-nam"/>').html(d.nombre_prod)))})}})},listarProductos=function(a){$("#busq_prod").val("");
var b=$("#moneda").val();$("#list-prods").empty();$.ajax({url:"?c=Inicio&a=listarProductos",dataType:"JSON",type:"POST",data:{cod:a},success:function(a){$.each(a,function(a,c){$("#list-prods").append($('<article class="product animated fadeIn" onclick="add('+c.id_areap+","+c.id_pres+",'"+c.nombre_prod+"','"+c.pres_prod+"',"+c.precio+",'"+c.Impresora.nombre+"');\"/>").append($('<div class="product-img"/>').html('<img src="assets/img/productos/'+c.imagen+'"></img><span class="price-tag">'+b+" "+c.precio+
'</span><span class="pres-tag">'+c.pres_prod+"</span>")).append($('<div class="product-nam"/>').html(c.nombre_prod)))})}})},add=function(a,b,c,d,e,f){$("#nvo-ped").css("display","block");$(".bc").css("display","block");pedido.registrar({area_id:parseInt(a),nombre_imp:f,producto_id:parseInt(b),producto:c,presentacion:d,cantidad:1,precio:parseFloat(e),comentario:""});4==$("#rol_usr").val()&&toastr.success("Agregado correctamente a la lista.");$("#btn-confirmar").removeAttr("disabled")};
$("#btn-confirmar").on("click",function(){$("#btn-confirmar").attr("disabled","true");if(0==pedido.detalle.items.length)return toastr.warning("Advertencia, Agregar producto(s) a la lista."),!1;pedido.detalle.cod_ped=$("#cod_p").val();$.ajax({type:"POST",url:"?c=Inicio&a=RegistrarPedido",data:pedido.detalle,success:function(a){if(1==a)return DatosGrles(),listarPedidos(),pedido.detalle.items.length=0,$("#nvo-ped-det").empty(),$("#nvo-ped").css("display","none"),$(".bc").css("display","none"),!1;2==
a&&window.open("inicio.php?Cod=f","_self")},error:function(a,b,c){console.log(c+" "+b)}});var a=pedido.detalle.items,b=[],c=[],d;for(d=0;d<a.length;d++)b.push(a[d].area_id);cont=[].concat($jscomp.arrayFromIterable(new Set(b)));for(b=0;b<cont.length;b++){for(d=0;d<a.length;d++)a[d].area_id==cont[b]&&(c.push(a[d]),nombre_impresora=a[d].nombre_imp);c={cod_tped:$("#cod_tipe").val(),nro_pedido:$(".mes_dg").text(),desc_salon:$("#salon_dg").val(),nombre_imp:nombre_impresora,items:c};window.open("view/inicio/imprimir/ticket.php?matriz="+
JSON.stringify(c),"_blank");c=[]}});
var pedido={detalle:{cod_ped:0,items:[]},registrar:function(a){var b=!1;a.total=a.cantidad*a.precio;this.detalle.items.forEach(function(c){c.producto_id===a.producto_id&&(c.cantidad+=a.cantidad,c.total+=a.total,b=!0)});b||this.detalle.items.push(a);this.refrescar()},actualizar:function(a,b){b=$(b).closest(".warning-element");$(this.detalle.items).each(function(c,d){if(c==a)return pedido.detalle.items[c]={producto_id:b.find("input[name='producto_id']").val(),area_id:b.find("input[name='area_id']").val(),nombre_imp:b.find("input[name='nombre_imp']").val(),
producto:b.find("span[name='producto']").text(),presentacion:b.find("span[name='presentacion']").text(),comentario:b.find("input[name='comentario']").val(),cantidad:b.find("input[name='cantidad']").val(),precio:b.find("input[name='precio']").val()},pedido.detalle.items[c].total=pedido.detalle.items[c].precio*pedido.detalle.items[c].cantidad,!1});this.refrescar()},retirar:function(a){$(this.detalle.items).each(function(b,c){if(b==a)return pedido.detalle.items.splice(a,1),!1});this.refrescar()},refrescar:function(){this.detalle.total=
0;$(this.detalle.items).each(function(a,c){pedido.detalle.items[a].id=a;pedido.detalle.total+=c.total});this.detalle.igv=(.18*this.detalle.total).toFixed(2);this.detalle.subtotal=(this.detalle.total-this.detalle.igv).toFixed(2);this.detalle.total=this.detalle.total.toFixed(2);var a=$.templates("#nvo-ped-det-template").render(this.detalle);$("#nvo-ped-det").html(a);0==this.detalle.total&&($("#nvo-ped").css("display","none"),$(".bc").css("display","none"));$(".touchspin1").TouchSpin({buttondown_class:"btn btn-warning",
buttonup_class:"btn btn-warning",min:1,max:99,step:1,booster:!1,stepintervaldelay:6E5})},comentar:function(a){$("#com"+a).each(function(a){this.style.display="block"!==this.style.display?"block":"none";return!1})}};
$(function(){date=moment(new Date);var a=moment(date).format("D MMMM");$("#busq_cli").autocomplete({delay:1,autoFocus:!0,source:function(a,c){$.ajax({url:"?c=Inicio&a=BuscarCliente",type:"post",dataType:"json",data:{criterio:a.term},success:function(a){c($.map(a,function(a){return{id:a.id_cliente,dni:a.dni,nombres:a.nombre,fecha_n:a.fecha_nac}}))}})},select:function(b,c){var d=moment(c.item.fecha_n).format("D MMMM");$("#cliente_id").val(c.item.id);$("#nombre_c").val(c.item.nombres);a==d&&$("#hhb").addClass("mhb");
$(this).blur()},change:function(){$("#busq_cli").val("");$("#busq_cli").focus()}}).autocomplete("instance")._renderItem=function(a,c){return $("<li>").append(c.nombres).appendTo(a)};$("#busq_cli").autocomplete("option","appendTo",".frm-facturar")});
var desocuparMesa=function(a){$("#cod_pede").val(a);$("#mdl-desocupar-mesa").modal("show")},impPreCuenta=function(a,b,c){$.ajax({url:"?c=Inicio&a=preCuenta",type:"post",dataType:"json",data:{cod:b,est:c},success:function(a){return!0}}).done(function(){window.open("pedido_mesa.php?c=Inicio&a=ImprimirPC&Cod="+a,"_blank")})},facturar=function(a,b){$("#btn-fact").removeAttr("disabled");$("#list-items").empty();$("#cod_pedido").val(a);$("#tipoEmision").val(b);var c=$("#cod_tipe").val(),d=$("#moneda").val();
$.ajax({dataType:"JSON",type:"POST",url:"?c=Inicio&a=ListarDetallePed",data:{cod:a,tp:c},success:function(a){$.each(a.Detalle,function(a,c){var f=$("#totalPed").val(),e=(c.cantidad*c.precio).toFixed(2);1==b&&0<c.cantidad?($(".totalP").val(f),$(".totalP").text(formatNumber(f)),$("#total_pedido").val(f),$("#list-items").append($('<li class="success-element liwrithe"/>').append($('<div class="row"/>').append($('<div class="col-xs-1 col-sm-1 col-md-1"/>').html('<input type="hidden" name="cantProd[]" value="'+
c.cantidad+'"/><input type="hidden" name="precProd[]" value="'+c.precio+'"/>'+c.cantidad)).append($('<div class="col-xs-8 col-sm-8 col-md-8"/>').html('<input type="hidden" name="idProd[]" value="'+c.id_pres+'"/>'+c.Producto.nombre_prod+' <span class="label label-warning text-uppercase">'+c.Producto.pres_prod+"</span>")).append($('<div class="col-xs-3 col-sm-3 col-md-3 text-right"/>').html(d+" "+formatNumber(e)))))):2==b&&0<c.cantidad&&($(".totalP").val("0.00"),$(".totalP").text("0.00"),$("#total_pedido").val(0),
$(".t_sbt").val("0.00"),$(".t_sbt").text("0.00"),$("#list-items").append($('<li class="success-element priceU" data-price="'+c.precio+'"/>').append($('<div class="row"/>').append($('<div class="col-xs-2 col-sm-2 col-md-2"/>').html('<input type="hidden" class="cantidad" name="cantProd[]" value="0"/><input type="hidden" name="precProd[]" value="'+c.precio+'"/><input type="hidden" value="'+c.cantidad+'" class="cantOrg"/><input type="hidden" value="1" class="cantTemp"/><b></b> '+c.cantidad)).append($('<div class="col-xs-7 col-sm-7 col-md-7"/>').html('<input type="hidden" name="idProd[]" value="'+
c.id_pres+'"/>'+c.Producto.nombre_prod+' <p class="label label-warning text-uppercase">'+c.Producto.pres_prod+"</p>")).append($('<div class="col-xs-3 col-sm-3 col-md-3 text-right"/>').html(d+" <span>0.00</span>")))))});$(".priceU").on("click",function(){var a=$(this).find(".cantTemp").val();$(this).css("cssText","background: #f9e79f !important; color: #424949 !important;");$(this).find(".cantTemp").val(parseInt(a)+1);var c=$(this).find(".cantOrg").val();parseInt(c);$(this).find("b").text(a+" /");
var b=$(this).find("span").text(),d=$(this).attr("data-price");b=(parseFloat(b)+parseFloat(d)).toFixed(2);$(this).find("span").text(b);var e=0;$(this).find(".cantidad").val(a);parseInt(c)<parseInt(a)&&($(this).find(".cantTemp").val(1),$(this).css("cssText","background: none !important"),$(this).find("span").text("0.00"),$(this).find("b").text(""),$(this).find(".cantidad").val(0));$(".priceU").each(function(){e+=parseFloat($(this).find("span").text())});$(".totalP").val(e.toFixed(2));$(".totalP").text(formatNumber(e));
$("#total_pedido").val(e);$(".t_sbt").val(e.toFixed(2));$(".t_sbt").text(formatNumber(e))})},error:function(a,c,b){console.log(b+" "+c)}});$("#mdl-facturar").modal("show")};
$("#frm-facturar").submit(function(){if("0.00"==$(".totalP").val())toastr.warning("Advertencia, Seleccionar item de la lista.");else if(""==$("#tipo_pago").find("option:selected").val())toastr.warning("Advertencia, Seleccionar tipo de pago.");else if(""==$("#tipo_doc").val())toastr.warning("Advertencia, Seleccionar tipo de documento.");else if(""==$("#cliente_id").val())toastr.warning("Advertencia, Agregar un cliente al comprobante.");else{$("#btn-fact").attr("disabled","disabled");$(this);var a=
{tipo_pedido:0,tipoEmision:0,cod_pedido:0,cliente_id:0,tipo_doc:0,tipo_pago:0,pago_t:0,m_desc:0,total_pedido:0,idProd:[],cantProd:[],precProd:[]};a.tipo_pedido=$("#cod_tipe").val();a.tipoEmision=$("#tipoEmision").val();a.cod_pedido=$("#cod_pedido").val();a.cliente_id=$("#cliente_id").val();a.tipo_doc=$("#tipo_doc").val();a.tipo_pago=$("#tipo_pago").val();a.pago_t=$("#pago_t").val();a.m_desc=$("#m_desc").val();a.total_pedido=$("#total_pedido").val();a.idProd=$("input[name='idProd[]']").map(function(){return $(this).val()}).get();
a.cantProd=$("input[name='cantProd[]']").map(function(){return $(this).val()}).get();a.precProd=$("input[name='precProd[]']").map(function(){return $(this).val()}).get();var b=$("#cod_pedido").val();$.ajax({type:"POST",url:"?c=Inicio&a=RegistrarVenta",data:a,success:function(a){if(1==$("#tipoEmision").val())return a&&window.open("inicio.php","_self"),!0;if(2==$("#tipoEmision").val()){if(1==$("#cod_tipe").val())return a&&window.open("pedido_mesa.php?Cod="+b,"_self"),!0;if(2==$("#cod_tipe").val())return a&&
window.open("pedido_mostrador.php?Cod="+b,"_self"),!0;if(3==$("#cod_tipe").val())return a&&window.open("pedido_delivery.php?Cod="+b,"_self"),!0}},error:function(a,b,e){console.log(e+" "+b)}}).done(function(){window.open("lista_inf_ventas.php?c=Informe&a=ImprimirAll&Cod="+b,"_blank");return!0})}return!1});
var porcentajeTotal=function(){$("#desc").each(function(a){"block"!==this.style.display?(this.style.display="block",$("#sbt").css("display","block"),a=$(".totalP").val(),$(".t_sbt").val(a),$(".t_sbt").text(formatNumber(a)),$("#pago_e").val("0.00"),$("#pago_t").val("0.00"),$("#vuelto").text("0.00")):(this.style.display="none",a=$(".t_sbt").val(),$(".totalP").val(a),$(".totalP").text(formatNumber(a)),$("#sbt").css("display","none"),$("#pago_e").val("0.00"),$("#pago_t").val("0.00"),$("#vuelto").text("0.00"),
$("#porcentaje").val(""),$("#m_desc").val(""));return!1})};
$("#tipo_pago").on("change",function(){var a=$(this).find("option:selected").val();1==a?($("#pago_e").val(""),$("#pago_t").val(""),$("#pt").css("display","none"),$("#pe").css("display","block"),$("#vuelto").text("0.00"),$("#pago_t").val("0.00")):2==a?($("#pago_e").val(""),$("#pago_t").val(""),$("#pe").css("display","none"),$("#pt").css("display","block"),$("#vuelto").text("0.00"),$("#pago_e").val("0.00")):3==a&&($("#pago_e").val(""),$("#pago_t").val(""),$("#pe").css("display","block"),$("#pt").css("display",
"block"),$("#vuelto").text("0.00"))});$("#pago_e").on("keyup",function(){var a=$(".totalP").val(),b=$("#pago_e").val(),c=$("#pago_t").val();b=parseFloat(b)+parseFloat(c);a=(parseFloat(b)-parseFloat(a)).toFixed(2);isNaN(a)&&(a=0);$("#vuelto").text(formatNumber(a))});$("#pago_t").on("keyup",function(){var a=$(".totalP").val(),b=$("#pago_e").val(),c=$("#pago_t").val();b=parseFloat(b)+parseFloat(c);a=(parseFloat(b)-parseFloat(a)).toFixed(2);isNaN(a)&&(a=0);$("#vuelto").text(formatNumber(a))});
$("#porcentaje").on("keyup",function(){var a=$(".t_sbt").val(),b=($("#porcentaje").val()/100).toFixed(2);b=(a*b).toFixed(2);$("#m_desc").val(b);a=(a-b).toFixed(2);$(".totalP").val(a);$(".totalP").text(formatNumber(a))});$("#m_desc").on("keyup",function(){var a=$(".t_sbt").val(),b=$("#m_desc").val();a=(a-b).toFixed(2);$(".totalP").val(a);$(".totalP").text(formatNumber(a));$("#porcentaje").val("")});
$("#btnClienteLimpiar").click(function(){$("#cliente_id").val("");$("#cliente").val("");$("#nombre_c").val("");$("#cliente").focus();$("#hhb").removeClass("mhb")});$(".ent input").keypress(function(a){var b=String.fromCharCode(a.which);a=a.which;if(0!=b.search("[0-9]")&&8!=a)return!1});$(".dec input").keypress(function(a){var b=String.fromCharCode(a.which);a=a.which;if(0!=b.search("[0-9.]")&&8!=a)return!1});