$(function() {
    validarApertura();
    listDelivery();
    listMostrador();
    horaPedido();
    setInterval(horaPedido, 1E3);
    mensaje();
    $("#frm-gral").formValidation({
        framework: "bootstrap",
        excluded: ":disabled",
        fields: {}
    });
    $(".scroll_pedidos").slimscroll({
        height: 400
    });
    $("#frm-mesa").formValidation({
        framework: "bootstrap",
        excluded: ":disabled",
        fields: {
            nombClie: {
                validators: {
                    notEmpty: {
                        message: "Dato obligatorio"
                    }
                }
            }
        }
    });
    $("#frm-mostrador").formValidation({
        framework: "bootstrap",
        excluded: ":disabled",
        fields: {
            nombClie: {
                validators: {
                    notEmpty: {
                        message: "Dato obligatorio"
                    }
                }
            }
        }
    });
    $("#frm-delivery").formValidation({
        framework: "bootstrap",
        excluded: ":disabled",
        fields: {
            nombClie: {
                validators: {
                    notEmpty: {
                        message: "Dato obligatorio"
                    }
                }
            },
            telefClie: {
                validators: {
                    notEmpty: {
                        message: "Dato obligatorio"
                    }
                }
            }
        }
    });
    $("#frm-cambiar-mesa").formValidation({
        framework: "bootstrap",
        excluded: ":disabled",
        fields: {}
    }).on("success.form.fv", function(a) {
        a.preventDefault();
        $(a.target).data("formValidation").defaultSubmit()
    })
});
var validarApertura = function() {
    0 == $("#cod_ape").val() && $("#mdl-validar-apertura").modal("show")
};

function horaPedido() {
    moment.locale("es");
    $('input[name^="hora_pe"]').each(function(a) {
        var c = moment($(this).val()).fromNow();
        $("#hora_p" + a).text(c)
    })
}
var listMostrador = function() {
        $("#list-mostrador").empty();
        var a = $("#moneda").val();
        $.ajax({
            dataType: "JSON",
            type: "POST",
            url: "?c=Inicio&a=ListarMostrador",
            success: function(c) {
                $.each(c, function(c, b) {
                    "a" == b.estado && $("#list-mostrador").append($('<a onclick="listarPedidos(2,' + b.id_pedido + ",'" + b.nro_pedido + "',1)\"/>").append($('<li class="warning-element limost"/>').append($('<div class="row"/>').append($('<div class="col-md-2 text-center"/>').html('<strong><i class="fa fa-slack"></i>&nbsp;' + b.nro_pedido +
                        "</strong>")).append($('<div class="col-md-2 text-center"/>').html('<i class="fa fa-clock-o"></i>&nbsp;' + moment(b.fecha_pedido).format("h:mm A"))).append($('<div class="col-md-3 text-center"/>').html('<div class="progress progress-striped active" style="margin-bottom: -20px;"><div style="width: 100%" aria-valuemax="50" aria-valuemin="0" role="progressbar" class="progress-bar progress-bar-warning"><span>Pedido abierto...</span></div></div>')).append($('<div class="col-md-3"/>').html('<i class="fa fa-user"></i>&nbsp;' +
                        b.nomb_cliente)).append($('<div class="col-md-2 text-right"/>').html(a + " " + formatNumber(b.Total.total))))))
                })
            }
        })
    },
    listDelivery = function() {
        $("#list-preparacion").empty();
        $("#list-enviados").empty();
        var a = $("#moneda").val();
        $.ajax({
            dataType: "JSON",
            type: "POST",
            url: "?c=Inicio&a=ListarDelivery",
            success: function(c) {
                $.each(c, function(c, b) {
                    "a" == b.estado ? $("#list-preparacion").append($('<a onclick="listarPedidos(3,' + b.id_pedido + ",'" + b.nro_pedido + "',1)\"/>").append($('<li class="warning-element limost"/>').append($('<div class="row"/>').append($('<div class="col-md-2 text-center"/>').html('<strong><i class="fa fa-slack"></i>&nbsp;' +
                        b.nro_pedido + "</strong>")).append($('<div class="col-md-2 text-center"/>').html('<i class="fa fa-clock-o"></i>&nbsp;' + moment(b.fecha_pedido).format("h:mm A"))).append($('<div class="col-md-3"/>').html('<i class="fa fa-phone"></i>&nbsp;' + b.telefono)).append($('<div class="col-md-3"/>').html('<i class="fa fa-user"></i>&nbsp;' + b.nomb_cliente)).append($('<div class="col-md-2 text-right"/>').html(a + " " + formatNumber(b.Total.total)))))) : "x" == b.estado && b.fecha == $("#fecha").val() && $("#list-enviados").append($('<li class="success-element limost"/>').append($('<div class="row"/>').append($('<div class="col-md-2 text-center"/>').html('<strong><i class="fa fa-slack"></i>&nbsp;' +
                        b.nro_pedido + "</strong>")).append($('<div class="col-md-2 text-center"/>').html('<i class="fa fa-clock-o"></i>&nbsp;' + moment(b.fecha_pedido).format("h:mm A"))).append($('<div class="col-md-3"/>').html('<i class="fa fa-phone"></i>&nbsp;' + b.telefono)).append($('<div class="col-md-3"/>').html('<i class="fa fa-user"></i>&nbsp;' + b.nomb_cliente)).append($('<div class="col-md-2 text-right"/>').html(a + " " + formatNumber(b.Total.total)))))
                })
            }
        })
    },
    listarPedidos = function(a, c, e, b) {
        1 == a ? (tipaten = "pedido_mesa", $(".title-cab").html("Salon: " +
            b + " - Mesa: " + e)) : 2 == a ? (tipaten = "pedido_mostrador", $(".title-cab").html('Detalle: <br><i class="fa fa-slack"></i> ' + e)) : 3 == a && (tipaten = "pedido_delivery", $(".title-cab").html('Detalle: <br><i class="fa fa-slack"></i> ' + e));
        $(".cont01").css("display", "none");
        $(".cont02").css("display", "none");
        $(".cont03").css("display", "block");
        $("#list-nprod").empty();
        var f = $("#moneda").val();
        $.ajax({
            dataType: "JSON",
            type: "POST",
            url: "?c=Inicio&a=listarPedidos",
            data: {
                cod: c
            },
            success: function(a) {
                var b = 0,
                    c = 0;
                0 != a.length ?
                    $.each(a, function(a, d) {
                        c = d.cantidad * d.precio;
                        $("#list-nprod").append($('<blockquote class="animated fadeInLeft" style="cursor: pointer;" onclick="subPedido(' + d.id_pedido + "," + d.id_pres + ');"/>').append('<span class="product-name text-navy">' + d.Producto.nombre_prod + ' <span class="label label-warning text-uppercase">' + d.Producto.pres_prod + '</span></span><span class="price">' + f + formatNumber(c) + "</span><small><em>" + d.cantidad + "</em> Unidad(es) en " + f + formatNumber(d.precio) + " / Unidad(es)</small>"));
                        b = c +
                            b
                    }) : $("#list-nprod").html('<div class="panel panel-transparent tip-sales text-center"><div class="row"><div class="col-sm-8 col-sm-push-2"><h2 class="ich m-t-none">Ingrese pedidos...</h2></p></div></div></div>');
                $(".totalPagar").html('<span class="icon"><i class="fa fa-money fa-2x"></i></span><div class="text"><span>' + f + formatNumber(b) + "</span>por pagar</span>")
            }
        });
        $(".btn-footer").css("display", "block");
        $(".btn-form").html('<a class="btn btn-primary" href="' + tipaten + ".php?Cod=" + c + '"><i class="fa fa-sign-in"></i> Ingresar</a>')
    },
    nuevoPed = function(a, c, e) {
        $(".txt-telf").css("display", "none");
        $(".txt-direc").css("display", "none");
        $(".txt-mozo").css("display", "block");
        $("#telefClie").attr("disabled", "true");
        $("#direcClie").attr("disabled", "true");
        $(".codMesa").val(a);
        $(".cont01").css("display", "none");
        $(".cont02").css("display", "block");
        $(".cont03").css("display", "none");
        $(".title-cab").html("Salon: " + e + " - Mesa: " + c);
        $("#frm-gral").data("formValidation").resetForm($("#frm-gral"));
        $(".btn-footer").css("display", "block");
        $(".btn-form").html('<button type="submit" class="btn btn-primary btn-form"><i class="fa fa-sign-in"></i> Aceptar</button>');
        $(".totalPagar").html("")
    },
    registrarMesa = function(a, c, e) {
        $(".codMesa").val(a);
        $("#mdl-mesa").modal("show");
        $("#nombClie").val("Mesa " + c);
        $(".s-mesa").text(c);
        $(".mtp").html(e)
    },
    comboMesaOrigen = function(a) {
        $("#c_mesa").selectpicker("destroy");
        $.ajax({
            type: "POST",
            url: "?c=Inicio&a=ComboMesaOri",
            data: {
                cod: a
            },
            success: function(a) {
                $("#c_mesa").html(a);
                $("#c_mesa").selectpicker()
            },
            error: function() {
                $("#c_mesa").html("There was an error!")
            }
        })
    },
    comboMesaDestino = function(a) {
        $("#co_mesa").selectpicker("destroy");
        $.ajax({
            type: "POST",
            url: "?c=Inicio&a=ComboMesaDes",
            data: {
                cod: a
            },
            success: function(a) {
                $("#co_mesa").html(a);
                $("#co_mesa").selectpicker()
            },
            error: function() {
                $("#co_mesa").html("There was an error!")
            }
        })
    };
$("#cbo-salon-o").change(function() {
    var a = $("#cbo-salon-o").val();
    comboMesaOrigen(a);
    $("#frm-cambiar-mesa").formValidation("revalidateField", "c_mesa")
});
$("#cbo-salon-d").change(function() {
    var a = $("#cbo-salon-d").val();
    comboMesaDestino(a)
});
$(".btn-cm").click(function() {
    var a = $("#cbo-salon-o").val(),
        c = $("#cbo-salon-d").val();
    comboMesaOrigen(a);
    comboMesaDestino(c)
});
$(".tab01").click(function() {
    $(".div-btn-nuevo").css("display", "none");
    $(".cont01").css("display", "block");
    $(".nomPed").html("una mesa");
    $(".cont02").css("display", "none");
    $(".cont03").css("display", "none");
    $(".txt-telf").css("display", "none");
    $(".txt-direc").css("display", "none");
    $(".txt-mozo").css("display", "block");
    $("#frm-gral").attr("action", "?c=Inicio&a=RMesa");
    $("#telefClie").attr("disabled", "true");
    $("#direcClie").attr("disabled", "true");
    $("#codMozo").removeAttr("disabled");
    $(".title-cab").html("Detalle:");
    $(".totalPagar").html("");
    $(".btn-footer").css("display", "none")
});
$(".tab02").click(function() {
    $('input[name^="cod_tipe"]').val(2);
    $(".div-btn-nuevo").css("display", "block");
    $(".cont01").css("display", "block");
    $(".nomPed").html("un pedido");
    $(".cont02").css("display", "none");
    $(".cont03").css("display", "none");
    $(".txt-telf").css("display", "none");
    $(".txt-direc").css("display", "none");
    $(".txt-mozo").css("display", "none");
    $("#frm-gral").attr("action", "?c=Inicio&a=RMostrador");
    $("#telefClie").attr("disabled", "true");
    $("#direcClie").attr("disabled", "true");
    $("#codMozo").attr("disabled",
        "true");
    $(".title-cab").html("Detalle:");
    $(".totalPagar").html("");
    $(".btn-footer").css("display", "none")
});
$(".tab03").click(function() {
    $('input[name^="cod_tipe"]').val(3);
    $(".div-btn-nuevo").css("display", "block");
    $(".cont01").css("display", "block");
    $(".nomPed").html("un pedido");
    $(".cont02").css("display", "none");
    $(".cont03").css("display", "none");
    $(".txt-telf").css("display", "block");
    $(".txt-direc").css("display", "block");
    $(".txt-mozo").css("display", "none");
    $(".txt-motorizado").css("display", "block");
    $("#frm-gral").attr("action", "?c=Inicio&a=RDelivery");
    $("#telefClie").removeAttr("disabled");
    $("#direcClie").removeAttr("disabled");
    $("#motorizado").removeAttr("disabled");
    $("#codMozo").attr("disabled","true");
    $(".title-cab").html("Detalle:");
    $(".totalPagar").html("");
    $(".btn-footer").css("display", "none")
});
$(".btn-nped").click(function() {
    $(".cont01").css("display", "none");
    $(".cont02").css("display", "block");
    $(".cont03").css("display", "none");
    $("#frm-gral").data("formValidation").resetForm($("#frm-gral"));
    $(".btn-footer").css("display", "block");
    $(".btn-form").html('<button type="submit" class="btn btn-primary btn-form"><i class="fa fa-sign-in"></i> Aceptar</button>');
    $(".totalPagar").html("");
    $(".title-cab").html("Detalle:")
});
$(".btn-canc").click(function() {
    $("#frm-gral").data("formValidation").resetForm($("#frm-gral"));
    $(".cont01").css("display", "block");
    $(".cont02").css("display", "none");
    $(".cont03").css("display", "none");
    $(".btn-footer").css("display", "none");
    $(".totalPagar").html("");
    $(".title-cab").html("Detalle:")
});
$("#mdl-mesa").on("hidden.bs.modal", function() {
    $(this).find("form")[0].reset();
    $("#frm-mesa").formValidation("resetForm", !0);
    $("#cod_mozo").val("").selectpicker("refresh")
});
$("#mdl-mostrador").on("hidden.bs.modal", function() {
    $(this).find("form")[0].reset();
    $("#frm-mostrador").formValidation("resetForm", !0)
});
$("#mdl-cambiar-mesa").on("hidden.bs.modal", function() {
    $(this).find("form")[0].reset();
    $("#frm-cambiar-mesa").formValidation("resetForm", !0);
    $("#c_mesa").val("").selectpicker("refresh");
    $("#co_mesa").val("").selectpicker("refresh")
});
$("#mdl-delivery").on("hidden.bs.modal", function() {
    $(this).find("form")[0].reset();
    $("#frm-delivery").formValidation("resetForm", !0)
});
var mensaje = function() {
        "d" == $("#cod_m").val() ? toastr.warning("Advertencia, Mesa ocupada.") : "f" == $("#cod_m").val() && toastr.warning("Advertencia, La mesa ya ha sido facturada.")
    },
    refresh = function() {
        location.reload()
    };